<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Atlas Panel â€” ClaudeDesk UI Prototype</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap');

  /* â”€â”€â”€ Tokyo Night Foundation â”€â”€â”€ */
  :root {
    --bg-deep:    #13141c;
    --bg-base:    #1a1b26;
    --bg-surface: #16161e;
    --bg-raised:  #1f2335;
    --bg-hover:   #24283b;

    --border:     #292e42;
    --border-dim: #222436;

    --accent:     #7aa2f7;
    --accent-dim: #3d59a1;
    --accent-glow: rgba(122, 162, 247, 0.15);

    --green:      #9ece6a;
    --green-bg:   #1a2e1a;
    --red:        #f7768e;
    --red-bg:     #2d1a22;
    --yellow:     #e0af68;
    --yellow-bg:  #2a2a1c;
    --magenta:    #bb9af7;
    --cyan:       #7dcfff;
    --orange:     #ff9e64;

    --text:       #a9b1d6;
    --text-dim:   #565f89;
    --text-faint: #3b4261;

    --panel-width: 520px;
    --radius:     8px;
    --radius-sm:  4px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'JetBrains Mono', monospace;
    background: var(--bg-deep);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
    overflow: hidden;
    height: 100vh;
  }

  /* â”€â”€â”€ App Shell (simulated) â”€â”€â”€ */
  .app-shell {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: var(--bg-base);
  }

  .titlebar {
    height: 36px;
    background: var(--bg-base);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 16px;
    font-size: 12px;
    color: var(--text-dim);
    flex-shrink: 0;
  }

  .tabbar {
    height: 44px;
    background: var(--bg-base);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 8px;
    flex-shrink: 0;
  }

  .tab {
    padding: 6px 14px;
    font-size: 12px;
    color: var(--text-dim);
    background: transparent;
    border: 1px solid transparent;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.15s ease;
  }
  .tab:hover { background: var(--bg-raised); color: var(--text); }
  .tab.active { background: var(--bg-raised); color: var(--text); border-color: var(--border); }

  .toolbar-sep {
    width: 1px;
    height: 20px;
    background: var(--border);
    margin: 0 4px;
  }

  .toolbar-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-sm);
    border: none;
    background: transparent;
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.15s ease;
    font-size: 14px;
  }
  .toolbar-btn:hover { background: var(--bg-raised); color: var(--text); }
  .toolbar-btn.atlas-btn { color: var(--accent); }
  .toolbar-btn.atlas-btn:hover { background: var(--accent-glow); }

  .terminal-placeholder {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    color: var(--text-faint);
    font-size: 13px;
    background:
      radial-gradient(circle at 20% 50%, rgba(122,162,247,0.03) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(187,154,247,0.02) 0%, transparent 40%),
      var(--bg-base);
  }

  /* â”€â”€â”€ Backdrop â”€â”€â”€ */
  .backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    backdrop-filter: blur(2px);
    z-index: 100;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  .backdrop.visible { opacity: 1; pointer-events: auto; }

  /* â”€â”€â”€ Panel Shell â”€â”€â”€ */
  .atlas-panel {
    position: fixed;
    top: 0;
    right: 0;
    width: var(--panel-width);
    height: 100vh;
    background: var(--bg-base);
    border-left: 1px solid var(--border);
    z-index: 200;
    display: flex;
    flex-direction: column;
    transform: translateX(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: -8px 0 32px rgba(0, 0, 0, 0.4);
  }
  .atlas-panel.open { transform: translateX(0); }

  /* Panel Header */
  .panel-header {
    height: 52px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    background: var(--bg-surface);
  }

  .panel-title-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .panel-icon {
    width: 20px;
    height: 20px;
    color: var(--accent);
    opacity: 0.8;
  }

  .panel-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    letter-spacing: 0.5px;
  }

  .panel-badge {
    font-size: 10px;
    padding: 2px 7px;
    background: var(--accent-glow);
    color: var(--accent);
    border-radius: 10px;
    font-weight: 500;
  }

  .close-btn {
    width: 28px;
    height: 28px;
    border: none;
    background: transparent;
    color: var(--text-dim);
    cursor: pointer;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s ease;
    font-size: 16px;
  }
  .close-btn:hover { background: var(--bg-hover); color: var(--text); }

  /* Info Bar */
  .info-bar {
    padding: 10px 20px;
    border-bottom: 1px solid var(--border-dim);
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }
  .info-bar .dir-icon { color: var(--text-faint); font-size: 12px; }
  .info-bar .dir-path {
    font-size: 11px;
    color: var(--text-dim);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    flex: 1;
  }

  /* Panel Content */
  .panel-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .panel-content::-webkit-scrollbar { width: 6px; }
  .panel-content::-webkit-scrollbar-track { background: transparent; }
  .panel-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* Panel Footer */
  .panel-footer {
    padding: 14px 20px;
    border-top: 1px solid var(--border);
    flex-shrink: 0;
    background: var(--bg-surface);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 10px;
  }

  /* â”€â”€â”€ State Switcher (prototype only) â”€â”€â”€ */
  .state-switcher {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 999;
    display: flex;
    gap: 8px;
    padding: 10px 14px;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }

  .state-btn {
    padding: 6px 12px;
    font-size: 11px;
    font-family: 'JetBrains Mono', monospace;
    background: var(--bg-raised);
    color: var(--text-dim);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.15s ease;
  }
  .state-btn:hover { color: var(--text); border-color: var(--text-dim); }
  .state-btn.active { background: var(--accent); color: var(--bg-base); border-color: var(--accent); }

  /* â”€â”€â”€ Buttons â”€â”€â”€ */
  .btn {
    padding: 8px 18px;
    font-size: 12px;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 500;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.15s ease;
    border: none;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .btn-primary {
    background: var(--accent);
    color: var(--bg-base);
  }
  .btn-primary:hover { background: #5a8ad7; }

  .btn-secondary {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
  }
  .btn-secondary:hover { background: var(--bg-raised); }

  .btn-danger {
    background: transparent;
    color: var(--red);
    border: 1px solid rgba(247, 118, 142, 0.3);
  }
  .btn-danger:hover { background: var(--red-bg); border-color: var(--red); }

  .btn-ghost {
    background: transparent;
    color: var(--accent);
    border: none;
    padding: 6px 10px;
    font-size: 11px;
  }
  .btn-ghost:hover { background: var(--accent-glow); }

  .btn-lg {
    padding: 10px 24px;
    font-size: 13px;
  }

  /* â”€â”€â”€ IDLE STATE â”€â”€â”€ */
  .idle-state { padding: 24px 20px; }

  .atlas-status-card {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 20px;
  }

  .status-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 14px;
  }

  .status-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }
  .status-icon.exists {
    background: rgba(158, 206, 106, 0.1);
    color: var(--green);
    border: 1px solid rgba(158, 206, 106, 0.2);
  }
  .status-icon.missing {
    background: rgba(122, 162, 247, 0.1);
    color: var(--accent);
    border: 1px solid rgba(122, 162, 247, 0.2);
  }

  .status-title { font-size: 14px; font-weight: 600; }
  .status-subtitle { font-size: 11px; color: var(--text-dim); margin-top: 2px; }

  .file-list {
    list-style: none;
    margin: 14px 0;
    padding: 0;
  }

  .file-list li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    font-size: 12px;
    border-radius: var(--radius-sm);
    transition: background 0.1s ease;
  }
  .file-list li:hover { background: var(--bg-raised); }

  .file-list .name { color: var(--text); }
  .file-list .meta { color: var(--text-dim); font-size: 11px; }

  .explainer {
    margin-bottom: 20px;
  }

  .explainer h3 {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--text);
  }

  .feature-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .feature-card {
    padding: 14px;
    background: var(--bg-surface);
    border: 1px solid var(--border-dim);
    border-radius: var(--radius);
    transition: all 0.2s ease;
  }
  .feature-card:hover {
    border-color: var(--border);
    background: var(--bg-raised);
  }

  .feature-card .icon {
    font-size: 16px;
    margin-bottom: 8px;
    display: block;
  }
  .feature-card .label {
    font-size: 11px;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 4px;
  }
  .feature-card .desc {
    font-size: 10px;
    color: var(--text-dim);
    line-height: 1.5;
  }

  /* â”€â”€â”€ SCANNING STATE â”€â”€â”€ */
  .scanning-state { padding: 24px 20px; }

  .scan-phases { display: flex; flex-direction: column; gap: 20px; margin-bottom: 24px; }

  .phase {
    position: relative;
    padding-left: 36px;
  }

  .phase-connector {
    position: absolute;
    left: 13px;
    top: 28px;
    width: 1px;
    height: calc(100% + 8px);
    background: var(--border);
  }

  .phase-dot {
    position: absolute;
    left: 6px;
    top: 3px;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 2px solid var(--border);
    background: var(--bg-base);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 8px;
    transition: all 0.3s ease;
  }
  .phase.active .phase-dot {
    border-color: var(--accent);
    background: var(--accent);
    box-shadow: 0 0 8px var(--accent-glow);
    animation: pulse-dot 2s ease infinite;
  }
  .phase.complete .phase-dot {
    border-color: var(--green);
    background: var(--green);
    color: var(--bg-base);
  }
  .phase.complete .phase-connector { background: var(--green); }

  @keyframes pulse-dot {
    0%, 100% { box-shadow: 0 0 0 0 rgba(122,162,247,0.3); }
    50% { box-shadow: 0 0 0 6px rgba(122,162,247,0); }
  }

  .phase-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-faint);
    margin-bottom: 6px;
    transition: color 0.3s ease;
  }
  .phase.active .phase-title { color: var(--text); }
  .phase.complete .phase-title { color: var(--text-dim); }

  .phase-bar {
    height: 4px;
    background: var(--border-dim);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 6px;
  }

  .phase-bar-fill {
    height: 100%;
    border-radius: 2px;
    background: linear-gradient(90deg, var(--accent-dim), var(--accent));
    transition: width 0.5s ease;
    position: relative;
  }
  .phase.complete .phase-bar-fill {
    background: linear-gradient(90deg, #5a9e4a, var(--green));
  }
  .phase-bar-fill.animated::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 40px;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15));
    animation: shimmer 1.5s ease infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-40px); }
    100% { transform: translateX(0); }
  }

  .phase-detail {
    font-size: 11px;
    color: var(--text-dim);
  }
  .phase.active .phase-detail { color: var(--text-dim); }

  .phase-detail .count { color: var(--accent); font-weight: 500; }

  /* Discoveries */
  .discoveries {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
  }

  .discoveries-header {
    padding: 10px 16px;
    font-size: 10px;
    font-weight: 600;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1.5px;
    border-bottom: 1px solid var(--border-dim);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .discoveries-header .pulse {
    width: 6px;
    height: 6px;
    background: var(--green);
    border-radius: 50%;
    animation: blink 1.5s ease infinite;
  }
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .discovery-list {
    list-style: none;
    padding: 6px 0;
  }

  .discovery-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 7px 16px;
    font-size: 12px;
    animation: fadeInUp 0.3s ease forwards;
    opacity: 0;
  }
  .discovery-item:nth-child(1) { animation-delay: 0ms; }
  .discovery-item:nth-child(2) { animation-delay: 100ms; }
  .discovery-item:nth-child(3) { animation-delay: 200ms; }
  .discovery-item:nth-child(4) { animation-delay: 300ms; }
  .discovery-item:nth-child(5) { animation-delay: 400ms; }
  .discovery-item:nth-child(6) { animation-delay: 500ms; }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .discovery-icon {
    width: 22px;
    height: 22px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    flex-shrink: 0;
  }
  .discovery-icon.domain { background: rgba(122,162,247,0.12); color: var(--accent); }
  .discovery-icon.entry  { background: rgba(158,206,106,0.12); color: var(--green); }
  .discovery-icon.lang   { background: rgba(187,154,247,0.12); color: var(--magenta); }
  .discovery-icon.dep    { background: rgba(224,175,104,0.12); color: var(--yellow); }

  .discovery-text { color: var(--text); }
  .discovery-text .val { font-weight: 600; }

  /* â”€â”€â”€ PREVIEW STATE â”€â”€â”€ */
  .preview-state { display: flex; flex-direction: column; height: 100%; }

  /* Warning Banner */
  .warning-banner {
    padding: 10px 20px;
    font-size: 12px;
    color: var(--yellow);
    background: var(--yellow-bg);
    border-left: 3px solid var(--yellow);
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  /* Summary Bar */
  .summary-bar {
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--text-dim);
    background: var(--bg-surface);
    border-bottom: 1px solid var(--border-dim);
    flex-shrink: 0;
    flex-wrap: wrap;
  }

  .stat-pill {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 9px;
    background: var(--bg-raised);
    border-radius: 10px;
    font-size: 11px;
  }
  .stat-pill .num { color: var(--text); font-weight: 600; }
  .stat-pill .label { color: var(--text-dim); }

  /* Preview Tabs */
  .preview-tabs {
    display: flex;
    padding: 0 20px;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    background: var(--bg-base);
  }

  .preview-tab {
    padding: 10px 16px;
    font-size: 12px;
    color: var(--text-dim);
    border-bottom: 2px solid transparent;
    cursor: pointer;
    transition: all 0.15s ease;
    background: none;
    border-top: none;
    border-left: none;
    border-right: none;
    font-family: 'JetBrains Mono', monospace;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .preview-tab:hover { color: var(--text); background: var(--bg-raised); }
  .preview-tab.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
  }

  .tab-badge {
    font-size: 10px;
    padding: 1px 6px;
    background: var(--bg-raised);
    border-radius: 8px;
    color: var(--text-dim);
  }
  .preview-tab.active .tab-badge {
    background: var(--accent-glow);
    color: var(--accent);
  }

  /* Preview Content */
  .preview-content {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .preview-content::-webkit-scrollbar { width: 6px; }
  .preview-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* Markdown Rendering */
  .md-preview h1 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }
  .md-preview h2 {
    font-size: 15px;
    font-weight: 600;
    color: var(--text);
    margin: 20px 0 10px;
  }
  .md-preview p {
    font-size: 12px;
    color: var(--text-dim);
    line-height: 1.7;
    margin-bottom: 10px;
  }
  .md-preview code {
    font-size: 11px;
    background: var(--bg-surface);
    padding: 2px 6px;
    border-radius: 3px;
    color: var(--cyan);
    border: 1px solid var(--border-dim);
  }
  .md-preview pre {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
    margin: 12px 0;
    overflow-x: auto;
    font-size: 11px;
    line-height: 1.6;
  }
  .md-preview pre code {
    background: none;
    padding: 0;
    border: none;
    color: var(--text);
  }

  .md-preview table {
    width: 100%;
    border-collapse: collapse;
    margin: 12px 0;
    font-size: 11px;
  }
  .md-preview th {
    text-align: left;
    padding: 8px 12px;
    background: var(--bg-surface);
    color: var(--text-dim);
    font-weight: 600;
    border: 1px solid var(--border);
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .md-preview td {
    padding: 7px 12px;
    border: 1px solid var(--border-dim);
    color: var(--text);
  }
  .md-preview tr:hover td { background: var(--bg-raised); }
  .md-preview td code {
    font-size: 10px;
    color: var(--accent);
    background: rgba(122,162,247,0.08);
    border-color: rgba(122,162,247,0.15);
  }

  /* Inline Tags List */
  .tags-search {
    padding: 8px 12px;
    width: 100%;
    font-size: 12px;
    font-family: 'JetBrains Mono', monospace;
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    outline: none;
    margin-bottom: 12px;
    transition: border-color 0.15s ease;
  }
  .tags-search:focus { border-color: var(--accent); }
  .tags-search::placeholder { color: var(--text-faint); }

  .tag-row {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    transition: background 0.1s ease;
    cursor: pointer;
  }
  .tag-row:hover { background: var(--bg-raised); }

  .tag-checkbox {
    width: 16px;
    height: 16px;
    appearance: none;
    -webkit-appearance: none;
    border: 2px solid var(--border);
    border-radius: 3px;
    background: var(--bg-surface);
    cursor: pointer;
    flex-shrink: 0;
    margin-top: 2px;
    position: relative;
    transition: all 0.15s ease;
  }
  .tag-checkbox:checked {
    background: var(--accent);
    border-color: var(--accent);
  }
  .tag-checkbox:checked::after {
    content: 'âœ“';
    position: absolute;
    top: -1px;
    left: 2px;
    font-size: 10px;
    color: var(--bg-base);
    font-weight: 700;
  }

  .tag-info { flex: 1; min-width: 0; }
  .tag-file {
    font-size: 12px;
    color: var(--text);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .tag-comment {
    font-size: 10px;
    color: var(--text-dim);
    margin-top: 3px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* â”€â”€â”€ Diff View â”€â”€â”€ */
  .diff-toggle {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-bottom: 12px;
  }
  .diff-toggle-btn {
    padding: 4px 10px;
    font-size: 10px;
    font-family: 'JetBrains Mono', monospace;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.15s ease;
  }
  .diff-toggle-btn:first-child { border-radius: var(--radius-sm) 0 0 var(--radius-sm); }
  .diff-toggle-btn:last-child { border-radius: 0 var(--radius-sm) var(--radius-sm) 0; }
  .diff-toggle-btn.active {
    background: var(--accent-glow);
    border-color: var(--accent);
    color: var(--accent);
  }

  .diff-view {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    font-size: 11px;
    line-height: 1.6;
  }

  .diff-line {
    display: flex;
    padding: 1px 0;
  }
  .diff-line .line-num {
    width: 36px;
    text-align: right;
    padding: 0 8px 0 0;
    color: var(--text-faint);
    flex-shrink: 0;
    user-select: none;
  }
  .diff-line .line-content {
    flex: 1;
    padding: 0 12px;
    white-space: pre;
    overflow-x: auto;
  }
  .diff-line.added { background: var(--green-bg); }
  .diff-line.added .line-content { color: var(--green); }
  .diff-line.added .line-num { color: rgba(158,206,106,0.4); }
  .diff-line.removed { background: var(--red-bg); }
  .diff-line.removed .line-content { color: var(--red); }
  .diff-line.removed .line-num { color: rgba(247,118,142,0.4); }
  .diff-line.unchanged .line-content { color: var(--text-dim); }

  /* â”€â”€â”€ Footer Link â”€â”€â”€ */
  .footer-link {
    font-size: 11px;
    color: var(--accent);
    text-decoration: none;
    cursor: pointer;
    transition: opacity 0.15s ease;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .footer-link:hover { opacity: 0.8; text-decoration: underline; }

  /* â”€â”€â”€ Hidden views â”€â”€â”€ */
  .view { display: none; }
  .view.active { display: flex; flex-direction: column; height: 100%; }
  .idle-state.active, .scanning-state.active { display: block; }
</style>
</head>
<body>

<!-- App Shell -->
<div class="app-shell">
  <div class="titlebar">ClaudeDesk</div>
  <div class="tabbar">
    <div class="tab active">main-session</div>
    <div class="tab">api-refactor</div>
    <div class="toolbar-sep"></div>
    <button class="toolbar-btn" title="History">â±</button>
    <button class="toolbar-btn" title="Checkpoints">âš‘</button>
    <button class="toolbar-btn" title="Teams">ğŸ‘¥</button>
    <button class="toolbar-btn atlas-btn" title="Atlas" onclick="openPanel()">â—</button>
    <button class="toolbar-btn" title="Settings">âš™</button>
  </div>
  <div class="terminal-placeholder">
    Click the â— Atlas button above, or use the state switcher below
  </div>
</div>

<!-- Backdrop -->
<div class="backdrop" id="backdrop" onclick="closePanel()"></div>

<!-- Atlas Panel -->
<div class="atlas-panel" id="panel">
  <!-- Header -->
  <div class="panel-header">
    <div class="panel-title-row">
      <svg class="panel-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
        <line x1="8" y1="2" x2="8" y2="18"></line>
        <line x1="16" y1="6" x2="16" y2="22"></line>
      </svg>
      <span class="panel-title">Repository Atlas</span>
      <span class="panel-badge">MVP</span>
    </div>
    <button class="close-btn" onclick="closePanel()">âœ•</button>
  </div>

  <!-- Info Bar -->
  <div class="info-bar">
    <span class="dir-icon">ğŸ“</span>
    <span class="dir-path">C:\Users\carlo\Desktop\repositories\personal\claudedesk</span>
  </div>

  <!-- State: Idle (No Atlas) -->
  <div class="panel-content view idle-no-atlas" id="view-idle-no">
    <div class="idle-state">
      <div class="explainer">
        <h3>Generate a Repository Atlas</h3>
        <div class="feature-grid">
          <div class="feature-card">
            <span class="icon" style="color:var(--accent)">â—‡</span>
            <div class="label">Architecture Map</div>
            <div class="desc">Domain boundaries, layers, and module structure</div>
          </div>
          <div class="feature-card">
            <span class="icon" style="color:var(--green)">âŠ•</span>
            <div class="label">Entrypoint Index</div>
            <div class="desc">Key files that Claude should orient from</div>
          </div>
          <div class="feature-card">
            <span class="icon" style="color:var(--magenta)">âŸ¡</span>
            <div class="label">File-to-Domain Map</div>
            <div class="desc">Every source file mapped to its domain</div>
          </div>
          <div class="feature-card">
            <span class="icon" style="color:var(--yellow)">âŠ˜</span>
            <div class="label">Inline Tags</div>
            <div class="desc">Metadata comments in critical entrypoint files</div>
          </div>
        </div>
      </div>
      <button class="btn btn-primary btn-lg" style="width:100%" onclick="showView('scanning')">
        â— Generate Repository Atlas
      </button>
    </div>
  </div>

  <!-- State: Idle (Atlas Exists) -->
  <div class="panel-content view idle-exists" id="view-idle-yes">
    <div class="idle-state">
      <div class="atlas-status-card">
        <div class="status-header">
          <div class="status-icon exists">âœ“</div>
          <div>
            <div class="status-title">Atlas is current</div>
            <div class="status-subtitle">Last generated 2 hours ago</div>
          </div>
        </div>
        <ul class="file-list">
          <li>
            <span class="name">CLAUDE.md</span>
            <span class="meta">4.2 KB Â· 98 lines</span>
          </li>
          <li>
            <span class="name">docs/repo-index.md</span>
            <span class="meta">8.7 KB Â· 186 lines</span>
          </li>
          <li>
            <span class="name" style="color:var(--text-dim)">3 files with inline tags</span>
            <span class="meta">@atlas-entrypoint</span>
          </li>
        </ul>
      </div>

      <div style="display:flex; gap:10px">
        <button class="btn btn-secondary" style="flex:1" onclick="showView('scanning')">
          â†» Rebuild Atlas
        </button>
        <button class="btn btn-ghost">âš™ Settings</button>
      </div>
    </div>
  </div>

  <!-- State: Scanning -->
  <div class="panel-content view scanning" id="view-scanning">
    <div class="scanning-state">
      <div class="scan-phases">
        <div class="phase complete">
          <div class="phase-connector" style="background:var(--green)"></div>
          <div class="phase-dot">âœ“</div>
          <div class="phase-title">Enumerating files</div>
          <div class="phase-bar">
            <div class="phase-bar-fill" style="width: 100%"></div>
          </div>
          <div class="phase-detail">Found <span class="count">75</span> source files in 0.4s</div>
        </div>

        <div class="phase complete">
          <div class="phase-connector" style="background:var(--green)"></div>
          <div class="phase-dot">âœ“</div>
          <div class="phase-title">Analyzing imports</div>
          <div class="phase-bar">
            <div class="phase-bar-fill" style="width: 100%"></div>
          </div>
          <div class="phase-detail">Processed <span class="count">75/75</span> files Â· 312 import edges</div>
        </div>

        <div class="phase active">
          <div class="phase-connector"></div>
          <div class="phase-dot"></div>
          <div class="phase-title">Inferring structure</div>
          <div class="phase-bar">
            <div class="phase-bar-fill animated" style="width: 65%"></div>
          </div>
          <div class="phase-detail">Clustering domains... <span class="count">8/10</span> identified</div>
        </div>

        <div class="phase">
          <div class="phase-dot"></div>
          <div class="phase-title">Generating atlas</div>
          <div class="phase-bar">
            <div class="phase-bar-fill" style="width: 0%"></div>
          </div>
          <div class="phase-detail" style="color:var(--text-faint)">Pending...</div>
        </div>
      </div>

      <div class="discoveries">
        <div class="discoveries-header">
          <div class="pulse"></div>
          Live discoveries
        </div>
        <ul class="discovery-list">
          <li class="discovery-item">
            <div class="discovery-icon domain">â—‡</div>
            <span class="discovery-text"><span class="val">10</span> domains identified</span>
          </li>
          <li class="discovery-item">
            <div class="discovery-icon entry">âŠ•</div>
            <span class="discovery-text"><span class="val">3</span> entrypoints detected</span>
          </li>
          <li class="discovery-item">
            <div class="discovery-icon lang">Î»</div>
            <span class="discovery-text"><span class="val">TypeScript</span> primary language (75 files)</span>
          </li>
          <li class="discovery-item">
            <div class="discovery-icon dep">â‡„</div>
            <span class="discovery-text"><span class="val">74</span> IPC methods in contract</span>
          </li>
          <li class="discovery-item">
            <div class="discovery-icon domain">â—‡</div>
            <span class="discovery-text"><span class="val">23,200</span> total lines of code</span>
          </li>
          <li class="discovery-item">
            <div class="discovery-icon entry">âŠ•</div>
            <span class="discovery-text"><span class="val">3-layer</span> architecture detected</span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- State: Preview -->
  <div class="view preview-state" id="view-preview">
    <div class="warning-banner" id="overwrite-banner" style="display:none">
      âš  Existing atlas files will be overwritten
    </div>

    <div class="summary-bar">
      <span class="stat-pill"><span class="num">10</span> <span class="label">domains</span></span>
      <span class="stat-pill"><span class="num">3</span> <span class="label">entrypoints</span></span>
      <span class="stat-pill"><span class="num">75</span> <span class="label">files</span></span>
      <span class="stat-pill"><span class="num">23.2K</span> <span class="label">LOC</span></span>
    </div>

    <div class="preview-tabs">
      <button class="preview-tab active" onclick="switchTab(this, 'tab-claude')">CLAUDE.md</button>
      <button class="preview-tab" onclick="switchTab(this, 'tab-index')">repo-index.md</button>
      <button class="preview-tab" onclick="switchTab(this, 'tab-tags')">Inline Tags <span class="tab-badge">3</span></button>
      <button class="preview-tab" onclick="switchTab(this, 'tab-diff')">Diff</button>
    </div>

    <div class="preview-content" id="tab-claude">
      <div class="md-preview">
        <h1># ClaudeDesk</h1>
        <p>Electron desktop app wrapping Claude Code CLI with multi-session terminals, split views, and agent team visualization.</p>
        <h2>## Tech Stack</h2>
        <p>Electron 28 | React 18 | TypeScript | xterm.js | node-pty | Tailwind CSS | reactflow</p>
        <h2>## Architecture</h2>
        <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Main Process (Node.js)                     â”‚
â”‚  7 managers + IPC handlers + session pool   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ IPC (74 methods)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Preload (auto-derived context bridge)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Renderer (React 18)                        â”‚
â”‚  Hooks â†’ Components â†’ UI                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
        <h2>## Domain Map</h2>
        <table>
          <thead>
            <tr><th>Domain</th><th>Main</th><th>Renderer</th><th>IPC prefix</th></tr>
          </thead>
          <tbody>
            <tr><td>Sessions</td><td><code>session-manager</code>, <code>cli-manager</code></td><td><code>useSessionManager</code>, <code>Terminal</code></td><td><code>session:*</code></td></tr>
            <tr><td>Split View</td><td><code>settings-persistence</code></td><td><code>useSplitView</code>, <code>SplitLayout</code></td><td><code>settings:*</code></td></tr>
            <tr><td>Agent Teams</td><td><code>agent-team-manager</code></td><td><code>useAgentTeams</code>, <code>TeamPanel</code></td><td><code>teams:*</code></td></tr>
            <tr><td>Templates</td><td><code>prompt-templates-manager</code></td><td><code>CommandPalette</code></td><td><code>template:*</code></td></tr>
            <tr><td>History</td><td><code>history-manager</code></td><td><code>HistoryPanel</code></td><td><code>history:*</code></td></tr>
            <tr><td>Checkpoints</td><td><code>checkpoint-manager</code></td><td><code>CheckpointPanel</code></td><td><code>checkpoint:*</code></td></tr>
            <tr><td>Quota</td><td><code>quota-service</code></td><td><code>BudgetPanel</code></td><td><code>quota:*</code></td></tr>
            <tr><td>Drag-Drop</td><td><code>file-dragdrop-handler</code></td><td><code>DragDropOverlay</code></td><td><code>dragdrop:*</code></td></tr>
            <tr><td>Workspaces</td><td><code>settings-persistence</code></td><td><code>SettingsDialog</code></td><td><code>workspace:*</code></td></tr>
            <tr><td>Window</td><td><code>index.ts</code></td><td><code>AboutDialog</code></td><td><code>window:*</code></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="preview-content" id="tab-index" style="display:none">
      <div class="md-preview">
        <h1># ClaudeDesk â€” Repository Index</h1>
        <p>75 source files | ~23,200 LOC | 10 domains | 74 IPC methods</p>
        <h2>## Entrypoints</h2>
        <table>
          <thead><tr><th>File</th><th>Role</th></tr></thead>
          <tbody>
            <tr><td><code>src/main/index.ts</code></td><td>Main process â€” creates window, initializes managers</td></tr>
            <tr><td><code>src/renderer/App.tsx</code></td><td>Root React component â€” composes hooks and panels</td></tr>
            <tr><td><code>src/shared/ipc-contract.ts</code></td><td>IPC single source of truth â€” 74 methods</td></tr>
          </tbody>
        </table>
        <h2>## Sessions</h2>
        <table>
          <thead><tr><th>File</th><th>Layer</th><th>Role</th><th>Lines</th></tr></thead>
          <tbody>
            <tr><td><code>session-manager.ts</code></td><td>Main</td><td>Session lifecycle and state</td><td>419</td></tr>
            <tr><td><code>cli-manager.ts</code></td><td>Main</td><td>PTY spawning, buffering</td><td>227</td></tr>
            <tr><td><code>session-pool.ts</code></td><td>Main</td><td>Pre-warmed shell pool</td><td>277</td></tr>
            <tr><td><code>useSessionManager.ts</code></td><td>Renderer</td><td>Session CRUD hook</td><td>199</td></tr>
            <tr><td><code>Terminal.tsx</code></td><td>Renderer</td><td>xterm.js wrapper</td><td>677</td></tr>
          </tbody>
        </table>
        <h2>## Agent Teams</h2>
        <table>
          <thead><tr><th>File</th><th>Layer</th><th>Role</th><th>Lines</th></tr></thead>
          <tbody>
            <tr><td><code>agent-team-manager.ts</code></td><td>Main</td><td>fs.watch monitoring, linking</td><td>512</td></tr>
            <tr><td><code>TeamPanel.tsx</code></td><td>Renderer</td><td>Team overview UI</td><td>540</td></tr>
            <tr><td><code>AgentGraph.tsx</code></td><td>Renderer</td><td>reactflow visualization</td><td>253</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="preview-content" id="tab-tags" style="display:none">
      <input class="tags-search" type="text" placeholder="Search files...">
      <div class="tag-row">
        <input class="tag-checkbox" type="checkbox" checked>
        <div class="tag-info">
          <div class="tag-file">src/main/index.ts</div>
          <div class="tag-comment">// @atlas-entrypoint: Main process â€” creates window, initializes all 7 managers</div>
        </div>
      </div>
      <div class="tag-row">
        <input class="tag-checkbox" type="checkbox" checked>
        <div class="tag-info">
          <div class="tag-file">src/renderer/App.tsx</div>
          <div class="tag-comment">// @atlas-entrypoint: Root React component â€” composes all hooks, panels, dialogs</div>
        </div>
      </div>
      <div class="tag-row">
        <input class="tag-checkbox" type="checkbox" checked>
        <div class="tag-info">
          <div class="tag-file">src/shared/ipc-contract.ts</div>
          <div class="tag-comment">// @atlas-entrypoint: IPC single source of truth â€” 74 methods, auto-derives types</div>
        </div>
      </div>
    </div>

    <div class="preview-content" id="tab-diff" style="display:none">
      <div class="diff-toggle">
        <button class="diff-toggle-btn active">Unified</button>
        <button class="diff-toggle-btn">Side-by-side</button>
      </div>
      <div class="diff-view">
        <div class="diff-line unchanged"><span class="line-num">1</span><span class="line-content"># ClaudeDesk</span></div>
        <div class="diff-line unchanged"><span class="line-num">2</span><span class="line-content"></span></div>
        <div class="diff-line removed"><span class="line-num">3</span><span class="line-content">- Electron desktop app wrapping Claude Code CLI.</span></div>
        <div class="diff-line added"><span class="line-num">3</span><span class="line-content">+ Electron desktop app wrapping Claude Code CLI with multi-session terminals, split views, and agent team visualization.</span></div>
        <div class="diff-line unchanged"><span class="line-num">4</span><span class="line-content"></span></div>
        <div class="diff-line unchanged"><span class="line-num">5</span><span class="line-content">## Tech Stack</span></div>
        <div class="diff-line unchanged"><span class="line-num">6</span><span class="line-content"></span></div>
        <div class="diff-line removed"><span class="line-num">7</span><span class="line-content">- Electron 28 | React 18 | TypeScript</span></div>
        <div class="diff-line added"><span class="line-num">7</span><span class="line-content">+ Electron 28 | React 18 | TypeScript | xterm.js | node-pty | Tailwind CSS | reactflow</span></div>
        <div class="diff-line unchanged"><span class="line-num">8</span><span class="line-content"></span></div>
        <div class="diff-line added"><span class="line-num">9</span><span class="line-content">+ ## Architecture</span></div>
        <div class="diff-line added"><span class="line-num">10</span><span class="line-content">+</span></div>
        <div class="diff-line added"><span class="line-num">11</span><span class="line-content">+ 3-layer pattern per domain: Manager (main) â†’ Hook (renderer) â†’ Components</span></div>
        <div class="diff-line added"><span class="line-num">12</span><span class="line-content">+ IPC contract is the single source of truth â€” 74 methods.</span></div>
        <div class="diff-line unchanged"><span class="line-num">13</span><span class="line-content"></span></div>
        <div class="diff-line unchanged"><span class="line-num">14</span><span class="line-content">## Domain Map</span></div>
        <div class="diff-line unchanged"><span class="line-num">15</span><span class="line-content"></span></div>
        <div class="diff-line added"><span class="line-num">16</span><span class="line-content">+ | Domain | Main | Renderer | IPC prefix |</span></div>
        <div class="diff-line added"><span class="line-num">17</span><span class="line-content">+ |--------|------|----------|------------|</span></div>
        <div class="diff-line added"><span class="line-num">18</span><span class="line-content">+ | Sessions | session-manager, cli-manager | useSessionManager | session:* |</span></div>
        <div class="diff-line added"><span class="line-num">19</span><span class="line-content">+ | Agent Teams | agent-team-manager | TeamPanel | teams:* |</span></div>
      </div>
    </div>

    <!-- Footer for preview state -->
    <div class="panel-footer">
      <button class="btn btn-secondary" onclick="showView('idle-yes')">Cancel</button>
      <button class="btn btn-primary" onclick="handleApprove()">Approve & Write Atlas</button>
    </div>
  </div>
</div>

<!-- State Switcher (prototype control) -->
<div class="state-switcher">
  <button class="state-btn" onclick="showView('idle-no')">No Atlas</button>
  <button class="state-btn" onclick="showView('idle-yes')">Has Atlas</button>
  <button class="state-btn" onclick="showView('scanning')">Scanning</button>
  <button class="state-btn active" onclick="showView('preview')">Preview</button>
</div>

<script>
  const views = {
    'idle-no':  'view-idle-no',
    'idle-yes': 'view-idle-yes',
    'scanning': 'view-scanning',
    'preview':  'view-preview',
  };

  function showView(name) {
    // Hide all views
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    // Show target
    const el = document.getElementById(views[name]);
    if (el) el.classList.add('active');
    // Update switcher
    document.querySelectorAll('.state-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    // Open panel
    openPanel();
    // Show overwrite banner only when coming from "Has Atlas" state
    const banner = document.getElementById('overwrite-banner');
    if (name === 'preview' && banner) banner.style.display = 'none';
  }

  function openPanel() {
    document.getElementById('panel').classList.add('open');
    document.getElementById('backdrop').classList.add('visible');
  }

  function closePanel() {
    document.getElementById('panel').classList.remove('open');
    document.getElementById('backdrop').classList.remove('visible');
  }

  function switchTab(btn, tabId) {
    // Deactivate all tabs
    document.querySelectorAll('.preview-tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');
    // Hide all tab content
    ['tab-claude', 'tab-index', 'tab-tags', 'tab-diff'].forEach(id => {
      document.getElementById(id).style.display = 'none';
    });
    // Show selected
    document.getElementById(tabId).style.display = 'block';
  }

  function handleApprove() {
    closePanel();
    // In real implementation: trigger IPC write call
  }

  // Default: show preview
  document.getElementById('view-preview').classList.add('active');
  // Auto-open after short delay for demo
  setTimeout(openPanel, 300);
</script>
</body>
</html>
